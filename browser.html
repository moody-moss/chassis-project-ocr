<!doctype html>
<html>

<head>
    <!-- <meta http-equiv="Content-Security-Policy"
        content="default-src *; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://qwe-1.herokuapp.com/static/zxing-umd-browser.js"> -->
    <meta http-equiv="Content-Security-Policy"
        content="Content-Security-Policy: script-src 'sha256-ykUDm/F3G5LTN32TD+oWXCkv5lS+t5DTdWa+Vab+HSg='">
</head>

<body>

    <img id='img' crossorigin='anonymous' src='https://qwe-1.herokuapp.com/data-matrix.jpg'></img>
    <p id='result' class='result'> Result </p>


    <!-- https://unpkg.com/@zxing/library@0.18.5/umd/index.js -->
    <!-- https://qwe-1.herokuapp.com/static/zxing-umd-browser.js -->
    <script type='text/javascript' src='https://qwe-1.herokuapp.com/static/zxing-umd-browser.js'></script>
    <script>

        //-----------------------------------------------------------------------------

        window.addEventListener('load', function () {

            const codeReader = new ZXing.BrowserDatamatrixCodeReader()
            console.log('ZXing code reader initialized');
            const resultSN = document.getElementById('result')
            const img = document.getElementById('img')
            const decodeFun = (e) => {

                // DECODE DATA MATRIX
                codeReader.decodeFromImage(img)
                    .then(result => {
                        console.log(result)
                        resultSN.textContent = result.text
                        //console.log(`Started decode for image from ${img.src}`)
                    })
                    .catch(err => {
                        console.error(err);
                        resultSN.textContent = err
                    });


            };

            //document.getElementById('button').addEventListener('click', decodeFun)
            //window.onload(decodeFun)
            decodeFun()

        })

    </script>
</body>

</html>